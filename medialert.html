<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>MediAlert ‚Äì School Nurse Portal</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/html5-qrcode/minified/html5-qrcode.min.js"></script>
  <style>
    :root{
      --bg:linear-gradient(135deg,#f7fafc 0%,#edf2f7 100%);
      --card:rgba(255,255,255,.75);
      --primary:#4ade80;
      --accent:#60a5fa;
      --warning:#facc15;
      --danger:#f87171;
      --text:#334155;
      --border:rgba(100,116,139,.15);
      --shadow:0 8px 32px rgba(100,116,139,.15);
      --glow:0 0 20px rgba(74,222,128,.25);
    }
    [data-theme="dark"]{
      --bg:linear-gradient(135deg,#1e293b 0%,#0f172a 100%);
      --card:rgba(30,41,59,.65);
      --text:#e2e8f0;
      --border:rgba(148,163,184,.25);
      --shadow:0 8px 32px rgba(0,0,0,.35);
      --glow:0 0 25px rgba(74,222,128,.35);
    }
    *{box-sizing:border-box;margin:0;padding:0}
    body{
      font-family:'Inter','Segoe UI',sans-serif;
      background:var(--bg) fixed;
      color:var(--text);
      transition:background .4s,color .4s;
      min-height:100vh;
      display:flex;
      flex-direction:column;
      overflow-x:hidden;
    }
    .card{
      background:var(--card);
      border:1px solid var(--border);
      border-radius:24px;
      padding:24px;
      backdrop-filter:blur(12px);
      box-shadow:var(--shadow);
      transition:transform .3s,box-shadow .3s;
    }
    .card:hover{transform:translateY(-4px);box-shadow:var(--glow)}
    .btn-primary,.btn-secondary,.btn-outline,.btn-success{
      border:none;
      padding:14px 28px;
      border-radius:9999px;
      font-weight:600;
      cursor:pointer;
      transition:all .25s;
      backdrop-filter:blur(8px);
      box-shadow:var(--shadow);
    }
    .btn-primary{background:linear-gradient(135deg,var(--primary),#22c55e);color:#fff}
    .btn-secondary{background:linear-gradient(135deg,var(--accent),#3b82f6);color:#fff}
    .btn-outline{background:transparent;color:var(--text);border:1px solid var(--border)}
    .btn-success{background:linear-gradient(135deg,#16a34a,#15803d);color:#fff}
    .btn-primary:hover,.btn-secondary:hover,.btn-outline:hover,.btn-success:hover{
      transform:translateY(-3px) scale(1.03);box-shadow:var(--glow)
    }
    input,select,textarea{
      background:var(--card);
      border:1px solid var(--border);
      border-radius:16px;
      padding:12px 16px;
      color:var(--text);
      outline:none;
      transition:border .3s,box-shadow .3s;
    }
    input:focus,select:focus,textarea:focus{
      border-color:var(--primary);box-shadow:0 0 0 2px var(--primary);
    }
    header{
      display:flex;
      justify-content:space-between;
      align-items:center;
      padding:20px 32px;
      margin:20px 20px 0;
      background:var(--card);
      border:1px solid var(--border);
      border-radius:40px;
      backdrop-filter:blur(12px);
      box-shadow:var(--shadow);
    }
    header h1{margin:0;font-size:1.5rem;font-weight:600}
    header button{background:none;border:none;color:var(--text);cursor:pointer;font-size:.875rem}
    .app-shell{max-width:28rem;margin:0 auto;padding:0 1rem}
    @media(max-width:600px){
      header{margin:10px;padding:16px 20px}
      header h1{font-size:1.25rem}
    }
  </style>
</head>
<body>
<!-- üîä ALARM SOUND -->
<audio id="alertSound" src="https://actions.google.com/sounds/v1/alarms/alarm_clock.ogg" loop></audio>

<!-- ----------  LOGIN / SIGN-UP  ---------- -->
<div id="authPage" class="app-shell min-h-screen flex flex-col justify-center p-4">
  <div class="card">
    <div class="text-center mb-6">
      <div class="inline-block p-3 bg-green-100 rounded-full mb-2">
        <svg class="w-8 h-8 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01M12 5.5a7.5 7.5 0 017.5 7.5v1a7.5 7.5 0 01-15 0v-1a7.5-7.5 0 017.5-7.5z"/>
        </svg>
      </div>
      <h1 class="text-2xl font-bold text-green-600">MediAlert</h1>
      <p class="text-sm text-slate-500">School Nurse Portal</p>
    </div>

    <!-- QR SCANNER -->
    <div id="qrReader" class="mb-4 hidden">
      <div id="qr-reader" style="width:100%;border-radius:16px;overflow:hidden;"></div>
      <button onclick="stopQr()" class="btn-secondary w-full mt-2">Cancel Scan</button>
    </div>

    <!-- Student Login -->
    <div id="studentLoginForm" class="space-y-4">
      <button onclick="startQr('student')" class="btn-primary w-full py-3">üì∑ Scan Student QR</button>
      <input type="text" id="studentId" placeholder="Student ID (e.g., 2024-0001)" class="w-full">
      <input type="password" id="studentPin" placeholder="4-digit PIN" maxlength="4" class="w-full">
      <button id="studentLoginBtn" class="btn-primary w-full py-3">Login as Student</button>
      <button id="showNurseLoginBtn" class="btn-secondary w-full py-3">Nurse Login</button>
    </div>

    <!-- Nurse Login -->
    <div id="nurseLoginForm" class="hidden space-y-4">
      <input type="email" id="nurseEmail" placeholder="Nurse Email" class="w-full">
      <input type="password" id="nursePassword" placeholder="Password" class="w-full">
      <button id="nurseLoginBtn" class="btn-primary w-full py-3">Login as Nurse</button>
      <button id="backToStudentBtn" class="btn-secondary w-full py-3">Back to Student Login</button>
    </div>
  </div>
</div>

<!-- ----------  STUDENT HOME  ---------- -->
<div id="studentHome" class="app-shell min-h-screen p-4 hidden">
  <header class="flex justify-between items-center mb-4">
    <h1 class="text-xl font-bold text-green-600">MediAlert</h1>
    <button id="logoutBtn" class="text-sm text-slate-600">Logout</button>
  </header>

  <div id="studentInfoCard" class="card mb-4"></div>
  <div id="weatherCard" class="card mb-4"></div>

  <div id="nurseReminders" class="card mb-4">
    <h3 class="font-bold text-blue-600 mb-2">üìã Nurse Reminders</h3>
    <div id="remindersList" class="space-y-2"></div>
  </div>

  <button id="emergencyBtn" class="btn-primary w-full py-6 text-lg flex items-center justify-center gap-2">
    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01M12 5.5a7.5 7.5 0 017.5 7.5v1a7.5 7.5 0 01-15 0v-1a7.5-7.5 0 017.5-7.5z"/>
    </svg>
    Send Emergency Alert
  </button>

  <div class="mt-6">
    <h2 class="text-lg font-semibold mb-2">My Alerts</h2>
    <div id="historyList" class="space-y-2"></div>
  </div>
</div>

<!-- ----------  EMERGENCY FORM  ---------- -->
<div id="emergencyForm" class="app-shell min-h-screen p-4 hidden">
  <header class="flex items-center mb-4">
    <button id="backHomeBtn" class="mr-2 text-slate-600">‚Üê</button>
    <h1 class="text-xl font-bold text-green-600">Emergency Details</h1>
  </header>

  <div class="card space-y-4">
    <input id="studentName" type="text" placeholder="Student Name" class="w-full" readonly>
    <select id="location" class="w-full">
      <option value="">Select Location</option>
      <option>Room 101</option><option>Room 102</option><option>Room 103</option>
      <option>Gym</option><option>Cafeteria</option><option>Library</option>
    </select>
    <select id="emergencyType" class="w-full">
      <option>Medical Emergency</option><option>Injury - Minor</option>
      <option>Fire</option><option>Security Threat</option>
    </select>
    <textarea id="additionalInfo" placeholder="Additional info..." class="w-full" rows="3"></textarea>
    <button id="sendAlertBtn" class="btn-primary w-full py-3">Send Alert</button>
  </div>
</div>

<!-- ----------  NURSE DASHBOARD  ---------- -->
<div id="nurseDashboard" class="app-shell min-h-screen p-4 hidden">
  <header class="flex justify-between items-center mb-4">
    <h1 class="text-xl font-bold text-green-600">Nurse Dashboard</h1>
    <button id="logoutNurseBtn" class="text-sm text-slate-600">Logout</button>
  </header>

  <div id="weatherNurse" class="card mb-4"></div>

  <!-- QR lookup for teachers / nurses -->
  <div class="card mb-4">
    <h3 class="font-bold text-purple-600 mb-3">üì∑ Scan Student QR (Teacher / Nurse)</h3>
    <div id="qrReaderNurse" class="mb-3 hidden">
      <div id="qr-reader-nurse" style="width:100%;border-radius:16px;overflow:hidden;"></div>
      <button onclick="stopQrNurse()" class="btn-secondary w-full mt-2">Cancel Scan</button>
    </div>
    <button onclick="startQrNurse()" class="btn-primary w-full py-2">Scan Student QR</button>
  </div>

  <!-- Send Reminder -->
  <div class="card mb-4">
    <h3 class="font-bold text-blue-600 mb-3">üìÖ Send Appointment Reminder</h3>
    <div class="space-y-3">
      <input type="text" id="searchStudentId" placeholder="Enter Student ID" class="w-full">
      <button onclick="searchStudent()" class="btn-primary w-full py-2">Search Student</button>
      <div id="searchResult" class="hidden">
        <div id="studentDetails" class="text-sm text-slate-600 mb-2"></div>
        <input type="text" id="reminderMessage" placeholder="Appointment details" class="w-full">
        <button onclick="sendReminder()" class="btn-primary w-full py-2 mt-2">Send Reminder</button>
      </div>
    </div>
  </div>

  <!-- Manage Reminders -->
  <div class="card mb-4">
    <h3 class="font-bold text-green-600 mb-3">‚úÖ Manage Reminders</h3>
    <div class="space-y-2">
      <input type="text" id="manageSearchId" placeholder="Enter Student ID" class="w-full">
      <button onclick="viewStudentReminders()" class="btn-outline w-full py-2">View Reminders</button>
    </div>
    <div id="manageRemindersList" class="mt-3 space-y-2 hidden"></div>
  </div>

  <p id="pendingCount" class="text-sm text-yellow-600 mb-2"></p>
  <button id="clearResolvedBtn" class="btn-outline w-full mb-4 py-2">Clear Resolved Alerts</button>
  <div id="alertsList" class="space-y-3"></div>
</div>

<script>
// ----------  MOCK DATA  ----------
const STUDENT_DB = [
  { id: "2024-0001", pin: "1234", name: "Alice Johnson", grade: "Grade 10", section: "A" },
  { id: "2024-0002", pin: "1234", name: "Bob Smith", grade: "Grade 11", section: "B" },
  { id: "2024-0003", pin: "1234", name: "Carol Davis", grade: "Grade 9", section: "C" },
  { id: "2024-0004", pin: "1234", name: "David Wilson", grade: "Grade 12", section: "A" }
];
const NURSE_EMAIL = "nurse@school.edu";
const NURSE_PASSWORD = "nurse123";

let currentSearchStudent = null;
let html5QrCode, html5QrCodeNurse;

// ----------  QR HELPERS  ----------
function startQr(mode) {
  if (mode === 'student') {
    document.getElementById("qrReader").classList.remove("hidden");
    html5QrCode = new Html5Qrcode("qr-reader");
    html5QrCode.start(
      { facingMode: "environment" },
      { fps: 10, qrbox: 250 },
      decodedText => {
        const [id, pin] = decodedText.split("|");
        const student = STUDENT_DB.find(s => s.id === id && s.pin === pin);
        if (student) {
          localStorage.setItem("currentStudent", JSON.stringify(student));
          loadStudentInfo(); loadReminders(); loadHistory();
          showPage("studentHome");
          stopQr();
        } else {
          alert("Invalid QR code");
        }
      },
      () => {}
    ).catch(err => console.error(err));
  }
}

function stopQr() {
  if (html5QrCode) html5QrCode.stop().then(() => html5QrCode.clear());
  document.getElementById("qrReader").classList.add("hidden");
}

function startQrNurse() {
  document.getElementById("qrReaderNurse").classList.remove("hidden");
  html5QrCodeNurse = new Html5Qrcode("qr-reader-nurse");
  html5QrCodeNurse.start(
    { facingMode: "environment" },
    { fps: 10, qrbox: 250 },
    decodedText => {
      const [id] = decodedText.split("|");
      const student = STUDENT_DB.find(s => s.id === id);
      if (student) {
        document.getElementById("searchStudentId").value = student.id;
        searchStudent();
        stopQrNurse();
      } else {
        alert("Invalid QR code");
      }
    },
    () => {}
  ).catch(err => console.error(err));
}

function stopQrNurse() {
  if (html5QrCodeNurse) html5QrCodeNurse.stop().then(() => html5QrCodeNurse.clear());
  document.getElementById("qrReaderNurse").classList.add("hidden");
}

// ----------  WEATHER  ----------
async function loadWeather() {
  const apiKey = "3de4ed0edc2d9a1009a9f91d7675beb5";
  const city = "Davao";
  try {
    const res = await fetch(`https://api.openweathermap.org/data/2.5/weather?q=${city}&appid=${apiKey}&units=metric`);
    const data = await res.json();
    const temp = data.main.temp;
    const humidity = data.main.humidity;
    const card = `
      <div class="bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-xl p-4">
        <h3 class="font-bold">üå° ${temp.toFixed(1)}¬∞C</h3>
        <p class="text-sm">Humidity: ${humidity}%</p>
      </div>
    `;
    ["weatherCard", "weatherNurse"].forEach(id => document.getElementById(id) && (document.getElementById(id).innerHTML = card));
  } catch {
    ["weatherCard", "weatherNurse"].forEach(id => document.getElementById(id) && (document.getElementById(id).innerText = "Weather unavailable"));
  }
}
loadWeather(); setInterval(loadWeather, 600000);

// ----------  NAVIGATION  ----------
function showPage(page) {
  ["authPage", "studentHome", "emergencyForm", "nurseDashboard"].forEach(p => document.getElementById(p).classList.add("hidden"));
  document.getElementById(page).classList.remove("hidden");
}

// ----------  AUTH  ----------
document.getElementById("studentLoginBtn").onclick = () => {
  const id = document.getElementById("studentId").value;
  const pin = document.getElementById("studentPin").value;
  const student = STUDENT_DB.find(s => s.id === id && s.pin === pin);
  if (student) {
    localStorage.setItem("currentStudent", JSON.stringify(student));
    loadStudentInfo(); loadReminders(); loadHistory();
    showPage("studentHome");
  } else alert("Invalid Student ID or PIN");
};

document.getElementById("nurseLoginBtn").onclick = () => {
  const email = document.getElementById("nurseEmail").value;
  const pass = document.getElementById("nursePassword").value;
  if (email === NURSE_EMAIL && pass === NURSE_PASSWORD) {
    localStorage.setItem("userType", "nurse");
    loadNurseDashboard();
    showPage("nurseDashboard");
  } else alert("Invalid nurse credentials");
};

document.getElementById("showNurseLoginBtn").onclick = () => {
  document.getElementById("studentLoginForm").classList.add("hidden");
  document.getElementById("nurseLoginForm").classList.remove("hidden");
};
document.getElementById("backToStudentBtn").onclick = () => {
  document.getElementById("nurseLoginForm").classList.add("hidden");
  document.getElementById("studentLoginForm").classList.remove("hidden");
};

["logoutBtn", "logoutNurseBtn"].forEach(btn => {
  document.getElementById(btn).onclick = () => {
    localStorage.removeItem("currentStudent");
    localStorage.removeItem("userType");
    document.getElementById("alertSound").pause();
    document.getElementById("alertSound").currentTime = 0;
    showPage("authPage");
  };
});

// ----------  STUDENT FLOW  ----------
function loadStudentInfo() {
  const student = JSON.parse(localStorage.getItem("currentStudent"));
  if (student) {
    document.getElementById("studentInfoCard").innerHTML = `
      <div class="bg-gradient-to-r from-green-500 to-green-600 text-white rounded-xl p-4">
        <h3 class="font-bold">${student.name}</h3>
        <p class="text-sm">${student.grade} - ${student.section}</p>
        <p class="text-sm">ID: ${student.id}</p>
      </div>
    `;
    document.getElementById("studentName").value = student.name;
  }
}
function loadReminders() {
  const student = JSON.parse(localStorage.getItem("currentStudent"));
  if (!student) return;
  const reminders = JSON.parse(localStorage.getItem("nurseReminders") || "[]");
  const myReminders = reminders.filter(r => r.studentId === student.id && !r.completed);
  const list = document.getElementById("remindersList");
  list.innerHTML = myReminders.length
    ? myReminders.map(r => `
        <div class="bg-blue-50 p-3 rounded-lg">
          <p class="text-sm text-blue-800">${r.message}</p>
          <p class="text-xs text-blue-600 mt-1">${r.date}</p>
        </div>
      `).join("")
    : "<p class='text-sm text-slate-500'>No reminders</p>";
}
document.getElementById("emergencyBtn").onclick = () => showPage("emergencyForm");
document.getElementById("backHomeBtn").onclick = () => showPage("studentHome");
document.getElementById("sendAlertBtn").onclick = () => {
  const student = JSON.parse(localStorage.getItem("currentStudent"));
  if (!student) return alert("Student not logged in");
  const alert = {
    studentId: student.id, studentName: student.name,
    grade: student.grade, section: student.section,
    location: document.getElementById("location").value,
    type: document.getElementById("emergencyType").value,
    info: document.getElementById("additionalInfo").value,
    status: "PENDING", time: new Date().toLocaleString()
  };
  let alerts = JSON.parse(localStorage.getItem("alerts") || "[]");
  alerts.push(alert);
  localStorage.setItem("alerts", JSON.stringify(alerts));
  alert("Alert sent!");
  document.getElementById("additionalInfo").value = "";
  loadHistory(); showPage("studentHome");
};
function loadHistory() {
  const student = JSON.parse(localStorage.getItem("currentStudent"));
  if (!student) return;
  const alerts = JSON.parse(localStorage.getItem("alerts") || "[]");
  const myAlerts = alerts.filter(a => a.studentId === student.id);
  const list = document.getElementById("historyList");
  list.innerHTML = myAlerts.length
    ? myAlerts.map(a => `
        <div class="card">
          <p class="font-semibold">${a.type}</p>
          <p class="text-sm text-slate-600">${a.location} ‚Ä¢ ${a.time}</p>
          <span class="text-xs px-2 py-1 rounded-full ${a.status === "PENDING" ? "bg-yellow-100 text-yellow-800" : a.status === "In Progress" ? "bg-blue-100 text-blue-800" : "bg-green-100 text-green-800"}">${a.status}</span>
        </div>
      `).join("")
    : "<p class='text-sm text-slate-500'>No alerts yet</p>";
}

// ----------  NURSE FUNCTIONS  ----------
function searchStudent() {
  const id = document.getElementById("searchStudentId").value;
  const student = STUDENT_DB.find(s => s.id === id);
  if (student) {
    currentSearchStudent = student;
    document.getElementById("studentDetails").innerHTML = `<strong>${student.name}</strong><br>${student.grade} - ${student.section}`;
    document.getElementById("searchResult").classList.remove("hidden");
  } else alert("Student not found");
}
function sendReminder() {
  if (!currentSearchStudent) return;
  const msg = document.getElementById("reminderMessage").value;
  if (!msg.trim()) return alert("Enter reminder text");
  const reminders = JSON.parse(localStorage.getItem("nurseReminders") || "[]");
  reminders.push({ id: Date.now(), studentId: currentSearchStudent.id, studentName: currentSearchStudent.name, message: msg, date: new Date().toLocaleString(), completed: false });
  localStorage.setItem("nurseReminders", JSON.stringify(reminders));
  alert(`Reminder sent to ${currentSearchStudent.name}`);
  document.getElementById("reminderMessage").value = "";
  document.getElementById("searchResult").classList.add("hidden");
  document.getElementById("searchStudentId").value = "";
  currentSearchStudent = null;
}
function viewStudentReminders() {
  const id = document.getElementById("manageSearchId").value;
  const student = STUDENT_DB.find(s => s.id === id);
  if (!student) return alert("Student not found");
  const reminders = JSON.parse(localStorage.getItem("nurseReminders") || "[]");
  const list = document.getElementById("manageRemindersList");
  const studentReminders = reminders.filter(r => r.studentId === id);
  list.innerHTML = studentReminders.length
    ? studentReminders.map(r => `
        <div class="bg-gray-50 p-3 rounded-lg flex justify-between items-start">
          <div>
            <p class="text-sm">${r.message}</p>
            <p class="text-xs text-slate-500">${r.date}</p>
            ${r.completed ? '<span class="text-xs text-green-600">‚úÖ Completed</span>' : '<span class="text-xs text-yellow-600">‚è≥ Pending</span>'}
          </div>
          <div class="flex gap-1">
            ${!r.completed ? `<button onclick="markReminderComplete(${r.id})" class="btn-success text-xs px-2 py-1">Done</button>` : ''}
            <button onclick="deleteReminder(${r.id})" class="bg-red-500 text-white text-xs px-2 py-1 rounded">Delete</button>
          </div>
        </div>
      `).join("")
    : "<p class='text-sm text-slate-500'>No reminders for this student</p>";
  list.classList.remove("hidden");
}
function markReminderComplete(id) {
  let reminders = JSON.parse(localStorage.getItem("nurseReminders") || "[]");
  const r = reminders.find(r => r.id === id);
  if (r) { r.completed = true; localStorage.setItem("nurseReminders", JSON.stringify(reminders)); viewStudentReminders(); loadReminders(); }
}
function deleteReminder(id) {
  if (confirm("Delete this reminder?")) {
    let reminders = JSON.parse(localStorage.getItem("nurseReminders") || "[]");
    reminders = reminders.filter(r => r.id !== id);
    localStorage.setItem("nurseReminders", JSON.stringify(reminders));
    viewStudentReminders(); loadReminders();
  }
}

// ----------  NURSE DASHBOARD  ----------
function loadNurseDashboard() {
  const alerts = JSON.parse(localStorage.getItem("alerts") || "[]");
  const pending = alerts.filter(a => a.status === "PENDING");
  document.getElementById("pendingCount").textContent = `${pending.length} pending`;
  const alertSound = document.getElementById("alertSound");
  pending.length ? alertSound.play() : alertSound.pause();
  const list = document.getElementById("alertsList");
  list.innerHTML = alerts.map((a, i) => `
    <div class="card">
      <p class="font-bold">${a.type}</p>
      <p class="text-sm text-slate-600">${a.studentName} (${a.studentId})</p>
      <p class="text-sm text-slate-600">${a.grade} - ${a.section} ‚Ä¢ ${a.location}</p>
      <p class="text-xs text-slate-500 mb-2">${a.time}</p>
      ${a.info ? `<p class="text-sm text-gray-700 mb-2">Note: ${a.info}</p>` : ''}
      <div class="flex gap-2 flex-wrap">
        ${a.status === "PENDING" ? `<button onclick="updateStatus(${i}, 'In Progress')" class="btn-primary px-3 py-1 text-sm">Start</button>` : ""}
        ${a.status === "In Progress" ? `<button onclick="updateStatus(${i}, 'Resolved')" class="btn-primary px-3 py-1 text-sm">Resolve</button>` : ""}
      </div>
    </div>
  `).join("");
}
document.getElementById("clearResolvedBtn").onclick = () => {
  let alerts = JSON.parse(localStorage.getItem("alerts") || "[]");
  const resolvedCount = alerts.filter(a => a.status === "Resolved").length;
  if (resolvedCount === 0) return alert("No resolved alerts to clear");
  if (confirm(`Clear ${resolvedCount} resolved alert${resolvedCount > 1 ? 's' : ''}?`)) {
    alerts = alerts.filter(a => a.status !== "Resolved");
    localStorage.setItem("alerts", JSON.stringify(alerts));
    loadNurseDashboard();
  }
};
function updateStatus(i, status) {
  let alerts = JSON.parse(localStorage.getItem("alerts") || "[]");
  alerts[i].status = status;
  localStorage.setItem("alerts", JSON.stringify(alerts));
  loadNurseDashboard();
}

// ----------  INIT  ----------
window.onload = () => {
  const userType = localStorage.getItem("userType");
  const currentStudent = localStorage.getItem("currentStudent");
  if (userType === "nurse") { loadNurseDashboard(); showPage("nurseDashboard"); }
  else if (currentStudent) { loadStudentInfo(); loadReminders(); loadHistory(); showPage("studentHome"); }
};
setInterval(() => { if (localStorage.getItem("userType") === "nurse") loadNurseDashboard(); }, 3000);
</script>
</body>
</html>